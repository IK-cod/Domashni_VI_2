<!DOCTYPE html>
<html lang="mk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Домашни по Ученици</title>
    <style>
        :root {
            --color-cream-50: rgba(252, 252, 249, 1);
            --color-cream-100: rgba(255, 255, 253, 1);
            --color-slate-900: rgba(19, 52, 59, 1);
            --color-slate-500: rgba(98, 108, 113, 1);
            --color-teal-500: rgba(33, 128, 141, 1);
            --color-teal-600: rgba(29, 116, 128, 1);
            --color-teal-300: rgba(50, 184, 198, 1);
            --color-brown-600-rgb: 94, 82, 64;
            --color-teal-500-rgb: 33, 128, 141;
            --color-red-500: rgba(192, 21, 47, 1);
            --color-background: var(--color-cream-50);
            --color-surface: var(--color-cream-100);
            --color-text: var(--color-slate-900);
            --color-text-secondary: var(--color-slate-500);
            --color-primary: var(--color-teal-500);
            --color-primary-hover: var(--color-teal-600);
            --color-border: rgba(var(--color-brown-600-rgb), 0.2);
            --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
            --font-size-sm: 12px;
            --font-size-base: 14px;
            --font-size-lg: 16px;
            --font-size-xl: 18px;
            --font-size-2xl: 20px;
            --font-size-3xl: 24px;
            --space-4: 4px;
            --space-8: 8px;
            --space-12: 12px;
            --space-16: 16px;
            --space-20: 20px;
            --space-24: 24px;
            --radius-base: 8px;
            --radius-lg: 12px;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --color-charcoal-700: rgba(31, 33, 33, 1);
                --color-charcoal-800: rgba(38, 40, 40, 1);
                --color-gray-200: rgba(245, 245, 245, 1);
                --color-gray-300: rgba(167, 169, 169, 1);
                --color-gray-400-rgb: 119, 124, 124;
                --color-teal-300: rgba(50, 184, 198, 1);
                --color-teal-400: rgba(45, 166, 178, 1);
                --color-background: var(--color-charcoal-700);
                --color-surface: var(--color-charcoal-800);
                --color-text: var(--color-gray-200);
                --color-text-secondary: rgba(167, 169, 169, 0.7);
                --color-primary: var(--color-teal-300);
                --color-primary-hover: var(--color-teal-400);
                --color-border: rgba(var(--color-gray-400-rgb), 0.3);
                --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
            }
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--color-background);
            color: var(--color-text);
            padding: var(--space-20);
            line-height: 1.5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            font-size: var(--font-size-3xl);
            margin-bottom: var(--space-24);
            text-align: center;
            color: var(--color-text);
        }

        .controls {
            margin-bottom: var(--space-24);
        }

        .preset-controls, .add-controls {
            display: flex;
            gap: var(--space-12);
            flex-wrap: wrap;
            align-items: center;
        }

        .controls label {
            font-size: var(--font-size-base);
            color: var(--color-text);
        }

        .controls input {
            padding: var(--space-8) var(--space-12);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            background: var(--color-surface);
            color: var(--color-text);
            font-size: var(--font-size-base);
            min-width: 120px;
        }

        .btn {
            padding: var(--space-8) var(--space-16);
            background: var(--color-primary);
            color: var(--color-cream-50);
            border: none;
            border-radius: var(--radius-base);
            cursor: pointer;
            font-size: var(--font-size-base);
            font-weight: 500;
            transition: background 0.2s;
        }

        .btn:hover {
            background: var(--color-primary-hover);
        }

        .btn-secondary {
            background: rgba(var(--color-brown-600-rgb), 0.12);
            color: var(--color-text);
        }

        .btn-small {
            padding: var(--space-4) var(--space-8);
            font-size: var(--font-size-sm);
        }

        @media (prefers-color-scheme: dark) {
            .btn-secondary {
                background: rgba(var(--color-gray-400-rgb), 0.15);
            }
            .btn {
                color: var(--color-slate-900);
            }
        }

        .btn-secondary:hover {
            background: rgba(var(--color-brown-600-rgb), 0.2);
        }

        .table-container {
            background: var(--color-surface);
            border-radius: var(--radius-lg);
            border: 1px solid var(--color-card-border);
            overflow: auto;
            margin-bottom: var(--space-24);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: var(--space-12);
            text-align: left;
            border-bottom: 1px solid var(--color-border);
        }

        th {
            background: rgba(var(--color-brown-600-rgb), 0.05);
            font-weight: 600;
            color: var(--color-text);
            position: sticky;
            top: 0;
        }

        @media (prefers-color-scheme: dark) {
            th {
                background: rgba(var(--color-gray-400-rgb), 0.1);
            }
        }

        .student-name {
            font-weight: 500;
            min-width: 150px;
        }

        .homework-cell {
            text-align: center;
            min-width: 100px;
        }

        .homework-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--color-primary);
        }

        .stats-cell {
            font-weight: 600;
            color: var(--color-primary);
        }

        .student-controls {
            display: flex;
            gap: var(--space-8);
            align-items: center;
        }

        .date-header {
            writing-mode: vertical-lr;
            text-orientation: mixed;
            min-width: 80px;
            text-align: center;
        }

        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-16);
            margin-bottom: var(--space-24);
        }

        .summary-card {
            background: var(--color-surface);
            padding: var(--space-20);
            border-radius: var(--radius-lg);
            border: 1px solid var(--color-card-border);
            text-align: center;
        }

        .summary-label {
            font-size: var(--font-size-base);
            color: var(--color-text-secondary);
            margin-bottom: var(--space-8);
        }

        .summary-value {
            font-size: var(--font-size-2xl);
            font-weight: 600;
            color: var(--color-primary);
        }

        .delete-btn {
            background: var(--color-red-500);
            color: white;
            padding: var(--space-4) var(--space-8);
            font-size: var(--font-size-sm);
        }

        .delete-btn:hover {
            background: rgba(192, 21, 47, 0.8);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Домашни по Ученици</h1>
        
        <div class="controls">
            <div class="preset-controls">
                <button class="btn" onclick="setupPresetStudents()">18 Ученици</button>
                <button class="btn btn-secondary" onclick="editStudentNames()">Промени Имиња</button>
            </div>
            
            <div class="add-controls" style="margin-top: 12px;">
                <label for="homeworkDate">Датум:</label>
                <input type="date" id="homeworkDate">
                <button class="btn" onclick="addHomework()">Додај Домашна</button>
                
                <button class="btn btn-secondary" onclick="saveToFile()">Зачувај</button>
                <button class="btn btn-secondary" onclick="exportData()">Извези Податоци</button>
                <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData()">
                <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">Увezi Податоци</button>
                <button class="btn btn-secondary" onclick="clearAll()">Ресетирај се</button>
            </div>
        </div>

        <div class="summary" id="summary"></div>

        <div class="table-container">
            <table id="homeworkTable">
                <thead>
                    <tr id="tableHeader">
                        <th>Ученик</th>
                        <th>Вкупно</th>
                        <th>Процент</th>
                        <th>Акции</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let students = [];
        let homeworkDates = [];
        let homeworkData = {}; // {studentIndex: {dateIndex: true/false}}

        // Вчитај зачувани податоци
        function loadSavedData() {
            try {
                const savedStudents = localStorage.getItem('homework_students');
                const savedDates = localStorage.getItem('homework_dates');
                const savedData = localStorage.getItem('homework_data');
                
                if (savedStudents) {
                    students = JSON.parse(savedStudents);
                    console.log('Вчитани ученици:', students);
                }
                
                if (savedDates) {
                    homeworkDates = JSON.parse(savedDates);
                    console.log('Вчитани датуми:', homeworkDates);
                }
                
                if (savedData) {
                    homeworkData = JSON.parse(savedData);
                    console.log('Вчитани податоци за домашни:', homeworkData);
                }
            } catch (error) {
                console.error('Грешка при вчитување на податоци:', error);
                // Почни со празни податоци ако има грешка
                students = [];
                homeworkDates = [];
                homeworkData = {};
            }
        }

        // Зачувај податоци
        function saveData() {
            try {
                localStorage.setItem('homework_students', JSON.stringify(students));
                localStorage.setItem('homework_dates', JSON.stringify(homeworkDates));
                localStorage.setItem('homework_data', JSON.stringify(homeworkData));
                console.log('Податоци зачувани успешно');
            } catch (error) {
                console.error('Грешка при зачувување:', error);
                alert('Не можев да ги зачувам податоци. Проверете дали имате доволно место на уредот.');
            }
        }

        // Постави 18 ученици
        function setupPresetStudents() {
            const defaultNames = [
                'Ученик 1', 'Ученик 2', 'Ученик 3', 'Ученик 4', 'Ученик 5', 'Ученик 6',
                'Ученик 7', 'Ученик 8', 'Ученик 9', 'Ученик 10', 'Ученик 11', 'Ученик 12',
                'Ученик 13', 'Ученик 14', 'Ученик 15', 'Ученик 16', 'Ученик 17', 'Ученик 18'
            ];
            
            students = [...defaultNames];
            homeworkData = {}; // Ресетирај податоци за домашни
            updateTable();
            saveData();
        }

        // Промени имиња на ученици
        function editStudentNames() {
            if (students.length === 0) {
                alert('Прво додајте 18 ученици');
                return;
            }
            
            let editHtml = '<div style="max-height: 400px; overflow-y: auto; padding: 10px;">';
            editHtml += '<h3>Промени имиња на ученици:</h3>';
            
            students.forEach((name, index) => {
                editHtml += `<div style="margin: 8px 0;">`;
                editHtml += `<label>${index + 1}: </label>`;
                editHtml += `<input type="text" id="student_${index}" value="${name}" style="width: 200px; padding: 4px; margin-left: 8px;">`;
                editHtml += `</div>`;
            });
            
            editHtml += '<div style="margin-top: 20px; text-align: center;">';
            editHtml += '<button onclick="saveStudentNames()" style="margin-right: 10px; padding: 8px 16px;">Зачувај</button>';
            editHtml += '<button onclick="closeEditModal()">Откажи</button>';
            editHtml += '</div>';
            editHtml += '</div>';
            
            const modal = document.createElement('div');
            modal.id = 'editModal';
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center;
                z-index: 1000;
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: var(--color-surface); padding: 20px; border-radius: 12px;
                max-width: 500px; width: 90%; max-height: 80vh; overflow: hidden;
                border: 1px solid var(--color-card-border);
            `;
            content.innerHTML = editHtml;
            
            modal.appendChild(content);
            document.body.appendChild(modal);
        }

        // Зачувај нови имиња
        function saveStudentNames() {
            students.forEach((_, index) => {
                const input = document.getElementById(`student_${index}`);
                if (input && input.value.trim()) {
                    students[index] = input.value.trim();
                }
            });
            
            closeEditModal();
            updateTable();
            saveData();
            alert('Имињата се зачувани успешно!');
        }

        // Затвори модал
        function closeEditModal() {
            const modal = document.getElementById('editModal');
            if (modal) {
                document.body.removeChild(modal);
            }
        }

        // Додај нова домашна
        function addHomework() {
            const input = document.getElementById('homeworkDate');
            const date = input.value;
            
            if (!date) {
                alert('Ве молиме изберете датум');
                return;
            }
            
            const formattedDate = new Date(date).toLocaleDateString('mk-MK');
            
            if (homeworkDates.some(d => new Date(d).toLocaleDateString('mk-MK') === formattedDate)) {
                alert('Домашната за овој датум веќе постои');
                return;
            }
            
            homeworkDates.push(date);
            input.value = '';
            updateTable();
            saveData();
        }

        // Ажурирај табела
        function updateTable() {
            updateHeader();
            updateBody();
            updateSummary();
        }

        // Ажурирај заглавие на табела
        function updateHeader() {
            const header = document.getElementById('tableHeader');
            header.innerHTML = `
                <th class="student-name">Ученик</th>
                <th class="stats-cell">Вкупно</th>
                <th class="stats-cell">Процент</th>
                <th>Акции</th>
            `;
            
            homeworkDates.forEach((date, index) => {
                const th = document.createElement('th');
                th.className = 'date-header';
                th.innerHTML = `
                    <div>${new Date(date).toLocaleDateString('mk-MK')}</div>
                    <button class="btn delete-btn btn-small" onclick="removeHomework(${index})">×</button>
                `;
                header.insertBefore(th, header.children[header.children.length - 1]);
            });
        }

        // Ажурирај тело на табела
        function updateBody() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            
            students.forEach((student, studentIndex) => {
                const row = document.createElement('tr');
                
                // Име на ученик
                const nameCell = document.createElement('td');
                nameCell.className = 'student-name';
                nameCell.textContent = student;
                row.appendChild(nameCell);
                
                // Статистики
                let completedCount = 0;
                let totalCount = homeworkDates.length;
                
                homeworkDates.forEach((date, dateIndex) => {
                    if (homeworkData[studentIndex] && homeworkData[studentIndex][dateIndex] === 'present') {
                        completedCount++;
                    }
                });
                
                // Вкупно предадени
                const totalCell = document.createElement('td');
                totalCell.className = 'stats-cell';
                totalCell.textContent = `${completedCount}/${totalCount}`;
                row.appendChild(totalCell);
                
                // Процент
                const percentCell = document.createElement('td');
                percentCell.className = 'stats-cell';
                const percentage = totalCount > 0 ? Math.round((completedCount / totalCount) * 100) : 0;
                percentCell.textContent = `${percentage}%`;
                row.appendChild(percentCell);
                
                // Домашни (checkbox за секој датум)
                homeworkDates.forEach((date, dateIndex) => {
                    const cell = document.createElement('td');
                    cell.className = 'homework-cell';
                    
                    const statusSelect = document.createElement('select');
                    statusSelect.className = 'homework-status';
                    statusSelect.style.cssText = `
                        padding: 4px 8px; border: 1px solid var(--color-border);
                        border-radius: 4px; background: var(--color-surface);
                        color: var(--color-text); font-size: 12px;
                        cursor: pointer; min-width: 80px;
                    `;
                    
                    statusSelect.innerHTML = `
                        <option value="">─</option>
                        <option value="present">Има</option>
                        <option value="absent">Отсутен</option>
                        <option value="missing">Нема</option>
                    `;
                    
                    // Постави тековна вредност
                    const currentStatus = (homeworkData[studentIndex] && homeworkData[studentIndex][dateIndex]) || '';
                    statusSelect.value = currentStatus;
                    
                    statusSelect.addEventListener('change', function(e) {
                        toggleHomework(studentIndex, dateIndex, e.target.value);
                    });
                    
                    cell.appendChild(statusSelect);
                    row.appendChild(cell);
                });
                
                // Акции
                const actionsCell = document.createElement('td');
                actionsCell.innerHTML = `
                    <button class="btn delete-btn btn-small" onclick="removeStudent(${studentIndex})">Избриши</button>
                `;
                row.appendChild(actionsCell);
                
                tbody.appendChild(row);
            });
        }

        // Промени статус на домашна
        function toggleHomework(studentIndex, dateIndex, status) {
            if (!homeworkData[studentIndex]) {
                homeworkData[studentIndex] = {};
            }
            
            homeworkData[studentIndex][dateIndex] = status;
            
            // Ажурирај само статистиките без да ја реиницијализираш целата табела
            updateSummary();
            updateStudentStats(studentIndex);
            saveData();
        }
        
        // Нова функција за ажурирање само на статистиките за еден ученик
        function updateStudentStats(studentIndex) {
            const rows = document.querySelectorAll('#tableBody tr');
            if (rows[studentIndex]) {
                const row = rows[studentIndex];
                
                let completedCount = 0;
                let totalCount = homeworkDates.length;
                
                homeworkDates.forEach((date, dateIndex) => {
                    if (homeworkData[studentIndex] && homeworkData[studentIndex][dateIndex] === 'present') {
                        completedCount++;
                    }
                });
                
                // Ажурирај ги само ячейките со статистики
                const totalCell = row.children[1]; // Вкупно колона
                const percentCell = row.children[2]; // Процент колона
                
                totalCell.textContent = `${completedCount}/${totalCount}`;
                const percentage = totalCount > 0 ? Math.round((completedCount / totalCount) * 100) : 0;
                percentCell.textContent = `${percentage}%`;
            }
        }

        // Избриши ученик
        function removeStudent(index) {
            if (confirm(`Дали сте сигурни дека сакате да го избришете ${students[index]}?`)) {
                students.splice(index, 1);
                
                // Ажурирај податоци за домашни
                const newData = {};
                Object.keys(homeworkData).forEach(studentIndex => {
                    const idx = parseInt(studentIndex);
                    if (idx < index) {
                        newData[idx] = homeworkData[studentIndex];
                    } else if (idx > index) {
                        newData[idx - 1] = homeworkData[studentIndex];
                    }
                });
                homeworkData = newData;
                
                updateTable();
                saveData();
            }
        }

        // Избриши домашна
        function removeHomework(index) {
            if (confirm(`Дали сте сигурни дека сакате да ја избришете домашната од ${new Date(homeworkDates[index]).toLocaleDateString('mk-MK')}?`)) {
                homeworkDates.splice(index, 1);
                
                // Ажурирај податоци за домашни
                Object.keys(homeworkData).forEach(studentIndex => {
                    const newStudentData = {};
                    Object.keys(homeworkData[studentIndex]).forEach(dateIndex => {
                        const idx = parseInt(dateIndex);
                        if (idx < index) {
                            newStudentData[idx] = homeworkData[studentIndex][dateIndex];
                        } else if (idx > index) {
                            newStudentData[idx - 1] = homeworkData[studentIndex][dateIndex];
                        }
                    });
                    homeworkData[studentIndex] = newStudentData;
                });
                
                updateTable();
                saveData();
            }
        }

        // Ажурирај резиме
        function updateSummary() {
            const summary = document.getElementById('summary');
            
            let totalStudents = students.length;
            let totalHomeworks = homeworkDates.length;
            let totalSubmissions = 0;
            let totalPossible = totalStudents * totalHomeworks;
            
            Object.values(homeworkData).forEach(studentData => {
                Object.values(studentData).forEach(status => {
                    if (status === 'present') totalSubmissions++;
                });
            });
            
            const overallPercentage = totalPossible > 0 ? Math.round((totalSubmissions / totalPossible) * 100) : 0;
            
            summary.innerHTML = `
                <div class="summary-card">
                    <div class="summary-label">Вкупно Ученици</div>
                    <div class="summary-value">${totalStudents}</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">Вкупно Домашни</div>
                    <div class="summary-value">${totalHomeworks}</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">Предадени</div>
                    <div class="summary-value">${totalSubmissions}/${totalPossible}</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">Процент</div>
                    <div class="summary-value">${overallPercentage}%</div>
                </div>
            `;
        }

        // Зачувај во датотека
        function saveToFile() {
            let content = `Домашни по Ученици - Зачувано ${new Date().toLocaleString('mk-MK')}\n\n`;
            
            content += `РЕЗИМЕ:\n`;
            content += `Вкупно ученици: ${students.length}\n`;
            content += `Вкупно домашни: ${homeworkDates.length}\n`;
            
            let totalSubmissions = 0;
            let totalPossible = students.length * homeworkDates.length;
            
            Object.values(homeworkData).forEach(studentData => {
                Object.values(studentData).forEach(status => {
                    if (status === 'present') totalSubmissions++;
                });
            });
            
            content += `Предадени: ${totalSubmissions}/${totalPossible}\n`;
            content += `Процент: ${totalPossible > 0 ? Math.round((totalSubmissions / totalPossible) * 100) : 0}%\n\n`;
            
            content += `ДЕТАЛИ:\n`;
            content += `Ученик\t\t\tПредадени\tПроцент\n`;
            content += `${'─'.repeat(50)}\n`;
            
            students.forEach((student, studentIndex) => {
                let completed = 0;
                let absent = 0;
                let missing = 0;
                homeworkDates.forEach((date, dateIndex) => {
                    const status = homeworkData[studentIndex] && homeworkData[studentIndex][dateIndex];
                    if (status === 'present') {
                        completed++;
                    } else if (status === 'absent') {
                        absent++;
                    } else if (status === 'missing') {
                        missing++;
                    }
                });
                
                const percentage = homeworkDates.length > 0 ? Math.round((completed / homeworkDates.length) * 100) : 0;
                content += `${student.padEnd(20)}\t${completed}/${homeworkDates.length}\t\t${percentage}%\t(Отсутни: ${absent}, Нема: ${missing})\n`;
            });
            
            if (homeworkDates.length > 0) {
                content += `\nДАТУМИ НА ДОМАШНИ:\n`;
                homeworkDates.forEach(date => {
                    content += `${new Date(date).toLocaleDateString('mk-MK')}\n`;
                });
            }
            
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `domashni-uchenici-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Ресетирај сè
        function clearAll() {
            if (confirm('Дали сте сигурни дека сакате да ги избришете сите податоци?')) {
                students = [];
                homeworkDates = [];
                homeworkData = {};
                updateTable();
                saveData();
            }
        }

        // Постави денешен датум како стандардна вредност
        document.getElementById('homeworkDate').valueAsDate = new Date();

        // Извези податоци како JSON датотека
        function exportData() {
            const data = {
                students: students,
                homeworkDates: homeworkDates,
                homeworkData: homeworkData,
                exportDate: new Date().toISOString(),
                version: "1.0"
            };
            
            const jsonString = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `domashni-podatoci-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            alert('Податоците се извезени успешно! Зачувајте ја датотеката на сигурно место.');
        }

        // Увези податоци од JSON датотека
        function importData() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Не е избрана датотека');
                return;
            }
            
            if (!file.name.endsWith('.json')) {
                alert('Ве молиме изберете .json датотека');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // Валидирај податоци
                    if (!data.students || !Array.isArray(data.students)) {
                        throw new Error('Неважечки формат на податоци');
                    }
                    
                    // Прашај за потврда ако има постоечки податоци
                    if (students.length > 0 || homeworkDates.length > 0) {
                        if (!confirm('Ова ќе ги замени сите постоечки податоци. Дали сте сигурни?')) {
                            fileInput.value = ''; // Ресетирај input
                            return;
                        }
                    }
                    
                    // Вчитај податоци
                    students = data.students || [];
                    homeworkDates = data.homeworkDates || [];
                    homeworkData = data.homeworkData || {};
                    
                    // Ажурирај интерфејс
                    updateTable();
                    saveData();
                    
                    alert(`Податоците се увезени успешно!\nУченици: ${students.length}\nДомашни: ${homeworkDates.length}${data.exportDate ? '\nИзвезено на: ' + new Date(data.exportDate).toLocaleString('mk-MK') : ''}`);
                    
                } catch (error) {
                    console.error('Грешка при увоз:', error);
                    alert('Грешка при вчитување на датотеката. Проверете дали е правилна .json датотека.');
                }
                
                fileInput.value = ''; // Ресетирај input за повторна употреба
            };
            
            reader.onerror = function() {
                alert('Грешка при читање на датотеката');
                fileInput.value = '';
            };
            
            reader.readAsText(file);
        }

        // Тест на localStorage
        function testLocalStorage() {
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                return true;
            } catch (error) {
                console.error('localStorage не е достапен:', error);
                return false;
            }
        }

        // Вчитај податоци и иницијализирај
        if (testLocalStorage()) {
            loadSavedData();
        } else {
            alert('Внимание: Не можам да зачувувам податоци. Апликацијата ќе работи само за оваа сесија.');
        }
        updateTable();
    </script>
</body>
</html>
